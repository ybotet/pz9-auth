# Практическое занятие №9 - Регистрация и аутентификация пользователей
## Описание

Этот проект реализует систему регистрации и входа пользователей с безопасным хранением паролей с использованием bcrypt. Созданы эндпоинты для регистрации и аутентификации с валидацией данных и защитой от типичных угроз безопасности.

## Структура проекта
![alt text](<screen/Снимок экрана 2025-11-18 232355.png>)

## Установка и старт
1. Предварительные требования
    Go 1.21+
    PostgreSQL 12+
    curl или Postman для тестирования API

2. Настройка проекта
```go
# Создание проекта
mkdir pz9-auth && cd pz9-auth

# Инициализация Go модуля
go mod init example.com/pz9-auth

# Установка зависимостей
go get github.com/go-chi/chi/v5
go get gorm.io/gorm gorm.io/driver/postgres
go get golang.org/x/crypto/bcrypt
```

3. Настройка базы данных
```go
-- Создание базы данных
CREATE DATABASE pz9_auth;

-- Или с использованием psql
psql -U postgres -c "CREATE DATABASE pz9_auth;"
```

4. Содержимое .env:
```bash
DB_DSN=postgres://postgres:password@localhost:5432/pz9_auth?sslmode=disable
BCRYPT_COST=12
APP_ADDR=:8080
```

5. Запуск приложения:
```bash
go run cmd/api/main.go
```

## скриншоты
![alt text](<screen/Снимок экрана 2025-11-18 231113.png>) 
![alt text](<screen/Снимок экрана 2025-11-18 231240.png>) 
![alt text](<screen/Снимок экрана 2025-11-18 231310.png>) 
![alt text](<screen/Снимок экрана 2025-11-18 231451.png>) 
![alt text](<screen/Снимок экрана 2025-11-18 232017.png>)


## Вход пользователя
### Запрос:
```json
{
  "email": "alice@example.com",
  "password": "AliceSecure123"
}
```

### Успешный ответ:
```json
{
  "status": "ok",
  "user": {
    "id": 1,
    "email": "alice@example.com"
  }
}
```

## Контрольные вопросы

1. В чём разница между хранением пароля и хранением его хэша? Зачем соль? Почему bcrypt, а не SHA-256?

Пароль в открытом виде можно прочитать, а хэш - нет. Хэш это однонаправленное преобразование. Соль добавляет случайность чтобы одинаковые пароли имели разные хэши. bcrypt медленнее чем SHA-256 и специально создан для паролей, что защищает от быстрого перебора.

2. Что произойдёт при снижении/повышении cost у bcrypt? Как подобрать значение?

При увеличении cost хэширование становится медленнее и безопаснее. При уменьшении - быстрее но менее безопасно. Обычно используют 10-14. Для учебных проектов 12 нормально.

3. Какие статусы и ответы должны возвращать POST /auth/register и POST /auth/login в типичных сценариях?

Register: 201 при успехе, 409 если email занят, 400 при ошибках валидации.
Login: 200 при успехе, 401 при неверных данных, 400 при ошибках ввода.

4. Какие риски несут подробные сообщения об ошибках при логине?

Злоумышленник может узнать какие email есть в системе. Поэтому всегда пишем "неверный логин или пароль" даже если email не найден.

5. Почему в этом ПЗ не выдаём токен, и что изменится в ПЗ10 (JWT)?

В этом занятии мы только проверяем пароль. В ПЗ10 добавим JWT токены для доступа к защищенным ресурсам после успешного логина.